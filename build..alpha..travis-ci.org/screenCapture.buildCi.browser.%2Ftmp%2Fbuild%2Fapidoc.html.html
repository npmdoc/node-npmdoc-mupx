<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a>mupx (v1.5.3)</a>
</h1>
<h4>Production Quality Meteor Deployments</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.mupx">module mupx</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.actions">
            function <span class="apidocSignatureSpan">mupx.</span>actions
            <span class="apidocSignatureSpan">(config, cwd, options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mupx.</span>actions.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mupx.</span>config</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mupx.</span>helpers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mupx.</span>linux</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mupx.actions">module mupx.actions</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.actions.actions">
            function <span class="apidocSignatureSpan">mupx.</span>actions
            <span class="apidocSignatureSpan">(config, cwd, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.actions.init">
            function <span class="apidocSignatureSpan">mupx.actions.</span>init
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mupx.actions.prototype">module mupx.actions.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.actions.prototype._createSessionsMap">
            function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>_createSessionsMap
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.actions.prototype._executePararell">
            function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>_executePararell
            <span class="apidocSignatureSpan">(actionName, args)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.actions.prototype._showKadiraLink">
            function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>_showKadiraLink
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.actions.prototype.deploy">
            function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>deploy
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.actions.prototype.logs">
            function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>logs
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.actions.prototype.reconfig">
            function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>reconfig
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.actions.prototype.restart">
            function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>restart
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.actions.prototype.setup">
            function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>setup
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.actions.prototype.start">
            function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>start
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.actions.prototype.stop">
            function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>stop
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mupx.config">module mupx.config</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.config.read">
            function <span class="apidocSignatureSpan">mupx.config.</span>read
            <span class="apidocSignatureSpan">(configFileName)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mupx.helpers">module mupx.helpers</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.helpers.printHelp">
            function <span class="apidocSignatureSpan">mupx.helpers.</span>printHelp
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mupx.linux">module mupx.linux</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.linux.deploy">
            function <span class="apidocSignatureSpan">mupx.linux.</span>deploy
            <span class="apidocSignatureSpan">(bundlePath, env, config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.linux.reconfig">
            function <span class="apidocSignatureSpan">mupx.linux.</span>reconfig
            <span class="apidocSignatureSpan">(env, config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.linux.restart">
            function <span class="apidocSignatureSpan">mupx.linux.</span>restart
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.linux.setup">
            function <span class="apidocSignatureSpan">mupx.linux.</span>setup
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.linux.start">
            function <span class="apidocSignatureSpan">mupx.linux.</span>start
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mupx.linux.stop">
            function <span class="apidocSignatureSpan">mupx.linux.</span>stop
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mupx" id="apidoc.module.mupx">module mupx</a></h1>


    <h2>
        <a href="#apidoc.element.mupx.actions" id="apidoc.element.mupx.actions">
        function <span class="apidocSignatureSpan">mupx.</span>actions
        <span class="apidocSignatureSpan">(config, cwd, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Actions(config, cwd, options) {
  this.cwd = cwd;
  this.config = config;
  this.sessionsMap = this._createSessionsMap(config);
  this.settingsFileName = options.settingsFileName;

  //get settingsFileName into env
  var setttingsJsonPath = path.resolve(this.cwd, this.settingsFileName);
  if(fs.existsSync(setttingsJsonPath)) {
    this.config.env['METEOR_SETTINGS'] = JSON.stringify(require(setttingsJsonPath));
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mupx.actions" id="apidoc.module.mupx.actions">module mupx.actions</a></h1>


    <h2>
        <a href="#apidoc.element.mupx.actions.actions" id="apidoc.element.mupx.actions.actions">
        function <span class="apidocSignatureSpan">mupx.</span>actions
        <span class="apidocSignatureSpan">(config, cwd, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Actions(config, cwd, options) {
  this.cwd = cwd;
  this.config = config;
  this.sessionsMap = this._createSessionsMap(config);
  this.settingsFileName = options.settingsFileName;

  //get settingsFileName into env
  var setttingsJsonPath = path.resolve(this.cwd, this.settingsFileName);
  if(fs.existsSync(setttingsJsonPath)) {
    this.config.env['METEOR_SETTINGS'] = JSON.stringify(require(setttingsJsonPath));
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.actions.init" id="apidoc.element.mupx.actions.init">
        function <span class="apidocSignatureSpan">mupx.actions.</span>init
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function () {
  var destMupJson = path.resolve('mup.json');
  var destSettingsJson = path.resolve('settings.json');

  if(fs.existsSync(destMupJson) || fs.existsSync(destSettingsJson)) {
    console.error('A Project Already Exists'.bold.red);
    process.exit(1);
  }

  var exampleMupJson = path.resolve(__dirname, '../example/mup.json');
  var exampleSettingsJson = path.resolve(__dirname, '../example/settings.json');

  copyFile(exampleMupJson, destMupJson);
  copyFile(exampleSettingsJson, destSettingsJson);

  console.log('Empty Project Initialized!'.bold.green);

  function copyFile(src, dest) {
    var content = fs.readFileSync(src, 'utf8');
    fs.writeFileSync(dest, content);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mupx.actions.prototype" id="apidoc.module.mupx.actions.prototype">module mupx.actions.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.mupx.actions.prototype._createSessionsMap" id="apidoc.element.mupx.actions.prototype._createSessionsMap">
        function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>_createSessionsMap
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_createSessionsMap = function (config) {
  var sessionsMap = {};

  config.servers.forEach(function(server) {
    var host = server.host;
    var auth = {username: server.username};

    if(server.pem) {
      auth.pem = fs.readFileSync(path.resolve(server.pem), 'utf8');
    } else {
      auth.password = server.password;
    }

    var nodemiralOptions = {
      ssh: server.sshOptions,
      keepAlive: true
    };

    if(!sessionsMap[server.os]) {
      sessionsMap[server.os] = {
        sessions: [],
        taskListsBuilder:require('./taskLists')(server.os)
      };
    }

    var session = nodemiral.session(host, auth, nodemiralOptions);
    session._serverConfig = server;
    sessionsMap[server.os].sessions.push(session);
  });

  return sessionsMap;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
require('colors');

module.exports = Actions;

function Actions(config, cwd, options) {
this.cwd = cwd;
this.config = config;
this.sessionsMap = this.<span class="apidocCodeKeywordSpan">_createSessionsMap</span>(config);
this.settingsFileName = options.settingsFileName;

//get settingsFileName into env
var setttingsJsonPath = path.resolve(this.cwd, this.settingsFileName);
if(fs.existsSync(setttingsJsonPath)) {
  this.config.env['METEOR_SETTINGS'] = JSON.stringify(require(setttingsJsonPath));
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.actions.prototype._executePararell" id="apidoc.element.mupx.actions.prototype._executePararell">
        function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>_executePararell
        <span class="apidocSignatureSpan">(actionName, args)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_executePararell = function (actionName, args) {
  var self = this;
  var sessionInfoList = _.values(self.sessionsMap);
  async.map(
    sessionInfoList,
    function(sessionsInfo, callback) {
      var taskList = sessionsInfo.taskListsBuilder[actionName]
        .apply(sessionsInfo.taskListsBuilder, args);
      taskList.run(sessionsInfo.sessions, function(summaryMap) {
        callback(null, summaryMap);
      });
    },
    whenAfterCompleted
  );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  },
  whenAfterCompleted
);
};

Actions.prototype.setup = function() {
this._showKadiraLink();
this.<span class="apidocCodeKeywordSpan">_executePararell</span>("setup", [this.config]);
};

Actions.prototype.deploy = function() {
var self = this;
self._showKadiraLink();

var buildLocation = path.resolve('/tmp', uuid.v4());
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.actions.prototype._showKadiraLink" id="apidoc.element.mupx.actions.prototype._showKadiraLink">
        function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>_showKadiraLink
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_showKadiraLink = function () {
  var versionsFile = path.join(this.config.app, '.meteor/versions');
  if(fs.existsSync(versionsFile)) {
    var packages = fs.readFileSync(versionsFile, 'utf-8');
    var hasKadira = kadiraRegex.test(packages);
    if(!hasKadira) {
      console.log(
        "â€œ Checkout " + "Kadira".bold + "!"+
        "\n  It's the best way to monitor performance of your app."+
        "\n  Visit: " + "https://kadira.io/mup".underline + " â€\n"
      );
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    });
  },
  whenAfterCompleted
);
};

Actions.prototype.setup = function() {
this.<span class="apidocCodeKeywordSpan">_showKadiraLink</span>();
this._executePararell("setup", [this.config]);
};

Actions.prototype.deploy = function() {
var self = this;
self._showKadiraLink();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.actions.prototype.deploy" id="apidoc.element.mupx.actions.prototype.deploy">
        function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>deploy
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">deploy = function () {
  var self = this;
  self._showKadiraLink();

  var buildLocation = path.resolve('/tmp', uuid.v4());
  var bundlePath = path.resolve(buildLocation, 'bundle.tar.gz');

  // spawn inherits env vars from process.env
  // so we can simply set them like this
  process.env.BUILD_LOCATION = buildLocation;

  var deployCheckWaitTime = this.config.deployCheckWaitTime;
  var appName = this.config.appName;
  var appPath = this.config.app;
  var buildOptions = this.config.buildOptions;

  console.log('Meteor app path    : ' + this.config.app);
  console.log('Using buildOptions : ' + JSON.stringify(buildOptions));
  buildApp(appPath, buildLocation, buildOptions, function(err) {
    if(err) {
      process.exit(1);
    } else {
      var sessionsData = [];
      _.forEach(self.sessionsMap, function (sessionsInfo) {
        var taskListsBuilder = sessionsInfo.taskListsBuilder;
        _.forEach(sessionsInfo.sessions, function (session) {
          sessionsData.push({
            taskListsBuilder: taskListsBuilder,
            session: session
          });
        });
      });

      async.mapSeries(
        sessionsData,
        function (sessionData, callback) {
          var session = sessionData.session;
          var taskListsBuilder = sessionData.taskListsBuilder
          var env = _.extend({}, self.config.env, session._serverConfig.env);
          var taskList = taskListsBuilder.deploy(
            bundlePath, env, self.config);
          taskList.run(session, function (summaryMap) {
            callback(null, summaryMap);
          });
        },
        whenAfterDeployed(buildLocation)
      )
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

async.mapSeries(
  sessionsData,
  function (sessionData, callback) {
    var session = sessionData.session;
    var taskListsBuilder = sessionData.taskListsBuilder
    var env = _.extend({}, self.config.env, session._serverConfig.env);
    var taskList = taskListsBuilder.<span class="apidocCodeKeywordSpan">deploy</span>(
      bundlePath, env, self.config);
    taskList.run(session, function (summaryMap) {
      callback(null, summaryMap);
    });
  },
  whenAfterDeployed(buildLocation)
)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.actions.prototype.logs" id="apidoc.element.mupx.actions.prototype.logs">
        function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>logs
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">logs = function () {
  var self = this;
  var tailOptions = process.argv.slice(3).join(" ");

  var sessions = [];

  for(var os in self.sessionsMap) {
    var sessionsInfo = self.sessionsMap[os];
    sessionsInfo.sessions.forEach(function(session) {
      sessions.push(session);
    });
  }

  async.map(
    sessions,
    function(session, callback) {
      var hostPrefix = '[' + session._host + '] ';
      var options = {
        onStdout: function(data) {
          process.stdout.write(hostPrefix + data.toString());
        },
        onStderr: function(data) {
          process.stderr.write(hostPrefix + data.toString());
        }
      };

      var command = 'sudo docker logs ' + tailOptions + ' ' + self.config.appName;
      session.execute(command, options, callback);
    },
    whenAfterCompleted
  );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.actions.prototype.reconfig" id="apidoc.element.mupx.actions.prototype.reconfig">
        function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>reconfig
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reconfig = function () {
  var self = this;
  var sessionInfoList = [];
  for(var os in self.sessionsMap) {
    var sessionsInfo = self.sessionsMap[os];
    sessionsInfo.sessions.forEach(function(session) {
      var env = _.extend({}, self.config.env, session._serverConfig.env);
      var taskList = sessionsInfo.taskListsBuilder.reconfig(
        env, self.config);
      sessionInfoList.push({
        taskList: taskList,
        session: session
      });
    });
  }

  async.mapSeries(
    sessionInfoList,
    function(sessionsInfo, callback) {
      sessionsInfo.taskList.run(sessionsInfo.session, function(summaryMap) {
        callback(null, summaryMap);
      });
    },
    whenAfterCompleted
  );
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Actions.prototype.reconfig = function() {
var self = this;
var sessionInfoList = [];
for(var os in self.sessionsMap) {
  var sessionsInfo = self.sessionsMap[os];
  sessionsInfo.sessions.forEach(function(session) {
    var env = _.extend({}, self.config.env, session._serverConfig.env);
    var taskList = sessionsInfo.taskListsBuilder.<span class="apidocCodeKeywordSpan">reconfig</span>(
      env, self.config);
    sessionInfoList.push({
      taskList: taskList,
      session: session
    });
  });
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.actions.prototype.restart" id="apidoc.element.mupx.actions.prototype.restart">
        function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>restart
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">restart = function () {
  this._executePararell("restart", [this.config]);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.actions.prototype.setup" id="apidoc.element.mupx.actions.prototype.setup">
        function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>setup
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setup = function () {
  this._showKadiraLink();
  this._executePararell("setup", [this.config]);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.actions.prototype.start" id="apidoc.element.mupx.actions.prototype.start">
        function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>start
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function () {
  this._executePararell("start", [this.config]);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.actions.prototype.stop" id="apidoc.element.mupx.actions.prototype.stop">
        function <span class="apidocSignatureSpan">mupx.actions.prototype.</span>stop
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stop = function () {
  this._executePararell("stop", [this.config]);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mupx.config" id="apidoc.module.mupx.config">module mupx.config</a></h1>


    <h2>
        <a href="#apidoc.element.mupx.config.read" id="apidoc.element.mupx.config.read">
        function <span class="apidocSignatureSpan">mupx.config.</span>read
        <span class="apidocSignatureSpan">(configFileName)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">read = function (configFileName) {
  var mupJsonPath = path.resolve(configFileName);
  // path of the mup.json file is the basedir and everything
  // will be based on that path
  var basedir = path.dirname(mupJsonPath);

  if(fs.existsSync(mupJsonPath)) {
    var mupJson = cjson.load(mupJsonPath);

    //initialize options
    mupJson.env = mupJson.env || {};
    mupJson.env['PORT'] = mupJson.env['PORT'] || 80;

    if(typeof mupJson.setupNode === "undefined") {
      mupJson.setupNode = true;
    }
    if(typeof mupJson.setupPhantom === "undefined") {
      mupJson.setupPhantom = true;
    }
    if(typeof mupJson.appName === "undefined") {
      mupJson.appName = "meteor";
    }

    if(typeof mupJson.enableUploadProgressBar === "undefined") {
      mupJson.enableUploadProgressBar = true;
    }

    //validating servers
    if(!mupJson.servers || mupJson.servers.length == 0) {
      mupErrorLog('Server information does not exist');
    } else {
      mupJson.servers.forEach(function(server) {
        var sshAgentExists = false;
        var sshAgent = process.env.SSH_AUTH_SOCK;
        if(sshAgent) {
          sshAgentExists = fs.existsSync(sshAgent);
          server.sshOptions = server.sshOptions || {};
          server.sshOptions.agent = sshAgent;
        }

        if(!server.host) {
          mupErrorLog('Server host does not exist');
        } else if(!server.username) {
          mupErrorLog('Server username does not exist');
        } else if(!server.password &amp;&amp; !server.pem &amp;&amp; !sshAgentExists) {
          mupErrorLog('Server password, pem or a ssh agent does not exist');
        } else if(!mupJson.app) {
          mupErrorLog('Path to app does not exist');
        }

        server.os = server.os || "linux";

        if(server.pem) {
          server.pem =
            rewritePath(server.pem, "SSH private key file is invalid");
        }

        server.env = server.env || {};

        var defaultEndpointUrl =
          format("http://%s:%s", server.host, mupJson.env['PORT']);
        server.env['CLUSTER_ENDPOINT_URL'] =
          server.env['CLUSTER_ENDPOINT_URL'] || defaultEndpointUrl;
      });
    }

    //rewrite ~ with $HOME
    mupJson.app = rewritePath(
      mupJson.app, "There is no meteor app in the current app path.");

    if(mupJson.ssl) {
      mupJson.ssl.port = mupJson.ssl.port || 443;
      mupJson.ssl.certificate = rewritePath(
        mupJson.ssl.certificate, "SSL certificate file does not exists.");
      mupJson.ssl.key = rewritePath(
        mupJson.ssl.key, "SSL key file does not exists.");
    }

    // additional build options
    mupJson.buildOptions = mupJson.buildOptions || {};

    return mupJson;
  } else {
      var message =
        'configuration file ' + configFileName + ' does not exist!'.red.bold;
    console.error(message);
    helpers.printHelp();
    process.exit(1);
  }

  function rewritePath(location, errorMessage) {
    if(!location) {
      return mupErrorLog(errorMessage);
    }

    var homeLocation = process.env.HOME;
    if(/^win/.test(process.platform)) {
      homeLocation = process.env.USERPROFILE;
    }

    var location = location.replace('~', homeLocation).trim();
    if(location.indexOf(0) !== "/" || location.indexOf(0) !== "\\") {
      // if path does not start with / or \ (on windows)
      // we need to make sure, they are from the basedir
      // but not from the current dir
      location = path.resolve(basedir, location);
    } else {
      // anyway, we need to resolve path for windows compatibility
      location = path.resolve(location);
    }
    if(!fs.existsSync(location)) {
      mupErrorLog(errorMessage);
    }

    return location;
  }

  function mupErrorLog(message) {
    var errorMessage = 'Invalid configuration file ' + configFileName + ': ' + message;
    console.error(errorMessage.red.bold);
    process.exit(1);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mupx.helpers" id="apidoc.module.mupx.helpers">module mupx.helpers</a></h1>


    <h2>
        <a href="#apidoc.element.mupx.helpers.printHelp" id="apidoc.element.mupx.helpers.printHelp">
        function <span class="apidocSignatureSpan">mupx.helpers.</span>printHelp
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">printHelp = function () {
  console.error('\nSyntax: mup &lt;action&gt; [--&lt;parameter&gt;]');
  console.error('');
  console.error('\nValid Actions (mandatory)');
  console.error('---------------------------');
  console.error('init                   - Initialize a Meteor Up project');
  console.error('setup                  - Setup the server');
  console.error('');
  console.error('deploy                 - Deploy app to server');
  console.error('reconfig               - Reconfigure the server and restart');
  console.error('');
  console.error('logs [-f --tail=all]   - Access logs');
  console.error('');
  console.error('start                  - Start your app instances');
  console.error('stop                   - Stop your app instances');
  console.error('restart                - Restart your app instances');
  console.error('\nAvailable Parameters (optional)');
  console.error('---------------------------------');
  console.error('--config=mup-prod.json - Specify the deployment configuration');
  console.error('                         Default value: mup.json');
  console.error('--settings=file.json   - Specify the Meteor.settings file');
  console.error('                         Default value: settings.json');
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  mupJson.buildOptions = mupJson.buildOptions || {};

  return mupJson;
} else {
    var message =
      'configuration file ' + configFileName + ' does not exist!'.red.bold;
  console.error(message);
  helpers.<span class="apidocCodeKeywordSpan">printHelp</span>();
  process.exit(1);
}

function rewritePath(location, errorMessage) {
  if(!location) {
    return mupErrorLog(errorMessage);
  }
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mupx.linux" id="apidoc.module.mupx.linux">module mupx.linux</a></h1>


    <h2>
        <a href="#apidoc.element.mupx.linux.deploy" id="apidoc.element.mupx.linux.deploy">
        function <span class="apidocSignatureSpan">mupx.linux.</span>deploy
        <span class="apidocSignatureSpan">(bundlePath, env, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">deploy = function (bundlePath, env, config) {
  var deployCheckWaitTime = config.deployCheckWaitTime;
  var appName = config.appName;
  var taskList = nodemiral.taskList("Deploy app '" + appName + "' (linux)");

  taskList.copy('Uploading bundle', {
    src: bundlePath,
    dest: '/opt/' + appName + '/tmp/bundle.tar.gz',
    progressBar: config.enableUploadProgressBar
  });

  copyEnvVars(taskList, env, appName);

  taskList.copy('Initializing start script', {
    src: path.resolve(TEMPLATES_DIR, 'start.sh'),
    dest: '/opt/' + appName + '/config/start.sh',
    vars: {
      appName: appName,
      useLocalMongo: config.setupMongo,
      port: env.PORT,
      sslConfig: config.ssl
    }
  });

  deployAndVerify(taskList, appName, env.PORT, deployCheckWaitTime);

  return taskList;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

async.mapSeries(
  sessionsData,
  function (sessionData, callback) {
    var session = sessionData.session;
    var taskListsBuilder = sessionData.taskListsBuilder
    var env = _.extend({}, self.config.env, session._serverConfig.env);
    var taskList = taskListsBuilder.<span class="apidocCodeKeywordSpan">deploy</span>(
      bundlePath, env, self.config);
    taskList.run(session, function (summaryMap) {
      callback(null, summaryMap);
    });
  },
  whenAfterDeployed(buildLocation)
)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.linux.reconfig" id="apidoc.element.mupx.linux.reconfig">
        function <span class="apidocSignatureSpan">mupx.linux.</span>reconfig
        <span class="apidocSignatureSpan">(env, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reconfig = function (env, config) {
  var appName = config.appName;
  var deployCheckWaitTime = config.deployCheckWaitTime;

  var taskList = nodemiral.taskList("Updating configurations (linux)");

  copyEnvVars(taskList, env, appName);
  startAndVerify(taskList, appName, env.PORT, deployCheckWaitTime);

  return taskList;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Actions.prototype.reconfig = function() {
var self = this;
var sessionInfoList = [];
for(var os in self.sessionsMap) {
  var sessionsInfo = self.sessionsMap[os];
  sessionsInfo.sessions.forEach(function(session) {
    var env = _.extend({}, self.config.env, session._serverConfig.env);
    var taskList = sessionsInfo.taskListsBuilder.<span class="apidocCodeKeywordSpan">reconfig</span>(
      env, self.config);
    sessionInfoList.push({
      taskList: taskList,
      session: session
    });
  });
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.linux.restart" id="apidoc.element.mupx.linux.restart">
        function <span class="apidocSignatureSpan">mupx.linux.</span>restart
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">restart = function (config) {
  var taskList = nodemiral.taskList("Restarting Application (linux)");

  var appName = config.appName;
  var port = config.env.PORT;
  var deployCheckWaitTime = config.deployCheckWaitTime;

  startAndVerify(taskList, appName, port, deployCheckWaitTime);

  return taskList;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.linux.setup" id="apidoc.element.mupx.linux.setup">
        function <span class="apidocSignatureSpan">mupx.linux.</span>setup
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setup = function (config) {
  var taskList = nodemiral.taskList('Setup (linux)');

  taskList.executeScript('Installing Docker', {
    script: path.resolve(SCRIPT_DIR, 'install-docker.sh')
  });

  taskList.executeScript('Setting up Environment', {
    script: path.resolve(SCRIPT_DIR, 'setup-env.sh'),
    vars: {
      appName: config.appName
    }
  });

  if(config.setupMongo) {
    taskList.copy('Copying MongoDB configuration', {
      src: path.resolve(TEMPLATES_DIR, 'mongodb.conf'),
      dest: '/opt/mongodb/mongodb.conf'
    });

    taskList.executeScript('Installing MongoDB', {
      script: path.resolve(SCRIPT_DIR, 'install-mongodb.sh')
    });
  }

  if(config.ssl) {
    taskList.copy('Copying SSL certificate bundle', {
      src: config.ssl.certificate,
      dest: '/opt/' + config.appName + '/config/bundle.crt'
    });

    taskList.copy('Copying SSL private key', {
      src: config.ssl.key,
      dest: '/opt/' + config.appName + '/config/private.key'
    });

    taskList.executeScript('Verifying SSL configurations', {
      script: path.resolve(SCRIPT_DIR, 'verify-ssl-configurations.sh'),
      vars: {
        appName: config.appName
      }
    });
  }

  return taskList;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.linux.start" id="apidoc.element.mupx.linux.start">
        function <span class="apidocSignatureSpan">mupx.linux.</span>start
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function (config) {
  var taskList = nodemiral.taskList("Starting Application (linux)");

  var appName = config.appName;
  var port = config.env.PORT;
  var deployCheckWaitTime = config.deployCheckWaitTime;

  startAndVerify(taskList, appName, port, deployCheckWaitTime);

  return taskList;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mupx.linux.stop" id="apidoc.element.mupx.linux.stop">
        function <span class="apidocSignatureSpan">mupx.linux.</span>stop
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stop = function (config) {
  var taskList = nodemiral.taskList("Stopping Application (linux)");

  //stopping
  taskList.executeScript('Stopping app', {
    script: path.resolve(SCRIPT_DIR, 'stop.sh'),
    vars: {
      appName: config.appName
    }
  });

  return taskList;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>